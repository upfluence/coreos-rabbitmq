%% -*- mode: erlang -*-
{{$dirs := ls "/discovery/rabbitmq"}}
{{$count := len $dirs}}
[
  {rabbit,
    [
      {loopback_users, []},
      [{vm_memory_high_watermark, 0.8},
      {cluster_partition_handling, autoheal},
      {{if gt $count 0}}{cluster_nodes, {['rabbit@{{join $dirs "','rabbit@"}}'], disc}}{{else}}{cluster_nodes, {[], disc}}{{end}}
    ]
  }
].
